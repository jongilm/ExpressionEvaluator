// testdata.cpp : Test functions for MyExpressionEvaluator.
// Jonathan Gilmore, 28/02/2009

#include "stdafx.h"
#include <math.h>
#include <conio.h>
#include <iostream>

#include "MyExpressionEvaluator.h"
#include "evaluator.h"

using namespace std;

typedef struct tagTESTDATA
{
  char *Expression;
  double ExpectedResult;
} tTESTDATA;

static tTESTDATA TestData[] =
{
  "4*3+2"       , (4.0*3.0+2.0),
  "(4*3)+2"     , ((4.0*3.0)+2.0),
  "4*(3+2)"     , (4.0*(3.0+2.0)),
  "(4*3+2)"     , ((4.0*3.0+2.0)),
  "(4)*3+2"     , ((4.0)*3.0+2.0),
  "4*(3)+2"     , (4.0*(3.0)+2.0),
  "4*3+(2)"     , (4.0*+3.0+(2.0)),

  "4+3*2"       , (4.0+3.0*2.0),
  "(4+3)*2"     , ((4.0+3.0)*2.0),
  "4+(3*2)"     , (4.0+(3.0*2.0)),
  "(4+3*2)"     , ((4.0+3.0*2.0)),
  "(4)+3*2"     , ((4.0)+3.0*2.0),
  "4+(3)*2"     , (4.0+(3.0)*2.0),
  "4+3*(2)"     , (4.0+3.0*(2.0)),

  "4/3+2"       , (4.0/3.0+2.0),
  "(4/3)+2"     , ((4.0/3.0)+2.0),
  "4/(3+2)"     , (4.0/(3.0+2.0)),
  "(4/3+2)"     , ((4.0/3.0+2.0)),
  "(4)/3+2"     , ((4.0)/3.0+2.0),
  "4/(3)+2"     , (4.0/(3.0)+2.0),
  "4/3+(2)"     , (4.0/+3.0+(2.0)),

  "4+3/2"       , (4.0+3.0/2.0),
  "(4+3)/2"     , ((4.0+3.0)/2.0),
  "4+(3/2)"     , (4.0+(3.0/2.0)),
  "(4+3/2)"     , ((4.0+3.0/2.0)),
  "(4)+3/2"     , ((4.0)+3.0/2.0),
  "4+(3)/2"     , (4.0+(3.0)/2.0),
  "4+3/(2)"     , (4.0+3.0/(2.0)),

  "4*3+2"       , (4.0*3.0+2.0),
  "(4*3)+2"     , ((4.0*3.0)+2.0),
  "4*(3+2)"     , (4.0*(3.0+2.0)),
  "(4*3+2)"     , ((4.0*3.0+2.0)),
  "(4)*3+2"     , ((4.0)*3.0+2.0),
  "4*(3)+2"     , (4.0*(3.0)+2.0),
  "4*3+(2)"     , (4.0*+3.0+(2.0)),

  "5-4+3*2"     , (5.0-4.0+3.0*2.0),
  "5-(4+3)*2"   , (5.0-(4.0+3.0)*2.0),
  "5-4+(3*2)"   , (5.0-4.0+(3.0*2.0)),
  "5-(4+3*2)"   , (5.0-(4.0+3.0*2.0)),
  "5-(4)+3*2"   , (5.0-(4.0)+3.0*2.0),
  "5-4+(3)*2"   , (5.0-4.0+(3.0)*2.0),
  "5-4+3*(2)"   , (5.0-4.0+3.0*(2.0)),

  "5-4+3*2+11"  , (5.0-4.0+3.0*2.0+11.0),
  "5-(4+3)*2+11", (5.0-(4.0+3.0)*2.0+11.0),
  "5-4+(3*2)+11", (5.0-4.0+(3.0*2.0)+11.0),
  "5-(4+3*2)+11", (5.0-(4.0+3.0*2.0)+11.0),
  "5-(4)+3*2+11", (5.0-(4.0)+3.0*2.0+11.0),
  "5-4+(3)*2+11", (5.0-4.0+(3.0)*2.0+11.0),
  "5-4+3*(2)+11", (5.0-4.0+3.0*(2.0)+11.0),

  " 5.123- 4.77 + 3.1 * 2.9 +11 ", ( 5.123- 4.77 + 3.1 * 2.9 +11.0 ),
  " 5.123-(4.77 + 3.1)* 2.9 +11 ", ( 5.123-(4.77 + 3.1)* 2.9 +11.0 ),
  " 5.123- 4.77 +(3.1 * 2.9)+11 ", ( 5.123- 4.77 +(3.1 * 2.9)+11.0 ),
  " 5.123-(4.77 + 3.1 * 2.9)+11 ", ( 5.123-(4.77 + 3.1 * 2.9)+11.0 ),
  " 5.123-(4.77)+ 3.1 * 2.9 +11 ", ( 5.123-(4.77)+ 3.1 * 2.9 +11.0 ),
  " 5.123- 4.77 +(3.1)* 2.9 +11 ", ( 5.123- 4.77 +(3.1)* 2.9 +11.0 ),
  " 5.123- 4.77 + 3.1 *(2.9)+11 ", ( 5.123- 4.77 + 3.1 *(2.9)+11.0 ),

  " 5.123- -4.77 + 3.1 * 2.9 +-11 ", ( 5.123- -4.77 + 3.1 * 2.9 +-11.0 ),
  " 5.123-(-4.77 + 3.1)* 2.9 +-11 ", ( 5.123-(-4.77 + 3.1)* 2.9 +-11.0 ),
  " 5.123- -4.77 +(3.1 * 2.9)+-11 ", ( 5.123- -4.77 +(3.1 * 2.9)+-11.0 ),
  " 5.123-(-4.77 + 3.1 * 2.9)+-11 ", ( 5.123-(-4.77 + 3.1 * 2.9)+-11.0 ),
  " 5.123-(-4.77)+ 3.1 * 2.9 +-11 ", ( 5.123-(-4.77)+ 3.1 * 2.9 +-11.0 ),
  " 5.123- -4.77 +(3.1)* 2.9 +-11 ", ( 5.123- -4.77 +(3.1)* 2.9 +-11.0 ),
  " 5.123- -4.77 + 3.1 *(2.9)+-11 ", ( 5.123- -4.77 + 3.1 *(2.9)+-11.0 ),

  "(3 + 10) * 50 / ((7 - 6) * 9)", (3.0 + 10.0) * 50.0 / ((7.0 - 6.0) * 9.0),
  "(1 + 10) * 50 / ((2 - 6) * 9)", (1.0 + 10.0) * 50.0 / ((2.0 - 6.0) * 9.0),
  "(0 + 10) * 50 / ((0 - 6) * 9)", (0.0 + 10.0) * 50.0 / ((0.0 - 6.0) * 9.0),

  NULL, 0
};

void TestEvaluator(CEvaluator *pEvaluator)
{
  double ActualResult;
  int i = 0;
  int Successes = 0;

  while (TestData[i].Expression != NULL)
  {
    if (!pEvaluator->SetExpression(TestData[i].Expression))
    {
      cout << endl << pEvaluator->GetErrorDescription(pEvaluator->GetErrorNumber()) << endl;
      getch();
      continue;
    }
    ActualResult = pEvaluator->EvaluateExpression();
    cout << "Expression: \"" << TestData[i].Expression << "\" = ";
    cout << "Expected(" << TestData[i].ExpectedResult << ") ";
    cout << "Actual(" << ActualResult << ") ";

    if (abs(ActualResult-TestData[i].ExpectedResult)<0.0001)
    {
      cout << "OK" << endl;
      Successes++;
    }
    else
    {
      cout << "FAIL" << endl;
      getch();
    }
    cout << endl;
    i++;
  }

  cout << endl << "SCORE = " << Successes << "/" << i << endl << endl;
}
